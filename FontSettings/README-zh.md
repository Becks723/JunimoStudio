#### [English](./README.md) | 中文

# 字体设置
设置游戏字体。

## 目录
- [下载&安装](#下载--安装)
- [使用说明](#使用说明)
  - [游戏字体分类](#游戏字体分类)
- [配置](#配置)
- [兼容性](#兼容性)
  - [和 SpriteMaster 的冲突](#和-spritemaster-冲突)
  - [回退至1.6.4版本之前的中文字体](#回退至164版本之前的中文字体)
- [给模组制作者看的](#给其他模组作者看的)
  - [编辑模组素材](#编辑模组素材)
  - [制作字体包](#制作字体包)
- [疑难解答](#疑难解答)
  - [SMAPI黄字 "Multiple mods want to provide the 'xxx' asset..."](#smapi黄字-multiple-mods-want-to-provide-the-xxx-asset)
- [反馈&帮助](#反馈--帮助)
- [更新日志](#更新日志)

## 下载 & 安装

1. 下载并安装[SMAPI](https://smapi.io/)。
2. [下载](https://www.nexusmods.com/stardewvalley/mods/12467)并安装本模组。文件如下表所示：

<table>
	<thead>
		<tr>
			<th>文件</th>
			<th>必下</th>
			<th>简介</th>
			<th>安装位置</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td><em>Font Settings x.x.x.zip</em></td>
			<td>√</td>
			<td>主文件</td>
			<td>解压放入Mods文件夹。</td>
		</tr>
		<tr>
			<td><em>vanilla font file for Chinese（中文）</em></td>
			<td></td>
			<td rowspan=3>这些是各个语言的原版字体。如果仅需调整字体大小、间距等而不变更字体，需要下载。</td>
			<td rowspan=3>解压放入本模组下assets/fonts文件夹，或者双击ttf文件安装进系统。</td>
		</tr>
		<tr>
			<td><em>vanilla font file for Chinese（中文 <strong>< 1.6.4版本</strong>）</em></td>
			<td></td>
		</tr>
		<tr>
			<td><em>vanilla font file for Japanese（日文）</em></td>
			<td></td>
		</tr>
		<tr>
			<td><em>vanilla font file for Korean（韩文）</em></td>
			<td></td>
		</tr>
	</tbody>
</table>


## 使用说明
打开字体设置菜单：
* 游戏主菜单左下角 大写的A按钮。
* 或 热键（默认 `左Alt + F`，可[配置](#配置)）
* 或 工具栏图标，大写的A按钮（需要安装[工具栏图标模组](https://www.nexusmods.com/stardewvalley/mods/11026)）

在菜单内修改各字体属性的值，完事了点击OK，设置完毕。

### 游戏字体分类
游戏内字体主要划分为三种：**小**、**中**、**对话字体**，需要分别设置。

- 小体: 用于物品描述、工具提示等。储存在`Content/Fonts/SmallFont`。
- 中体：字号稍微大点，用于物品名称、段落和游戏设置等。储存在`Content/Fonts/SpriteFont1`。
- 对话体：用于大标题和对话。储存在`Content/Fonts/Chinese`。

<img src="./docs/游戏字体分类1.png" width="50%"/> 
<img src="./docs/游戏字体分类2.png" width="50%"/>

#### 备注
* 字体列表扫描的是你电脑内安装的字体。支持的字体格式有：
	* TrueType（.ttf, .ttc）
	* OpenType（.otf, .otc, .ttf, .ttc）


## 配置

配合[模组配置菜单](https://www.nexusmods.com/stardewvalley/mods/5098)食用体验更佳！

| 选项 | 英文名 | 简介 | 备注 |
| --- | --- | --- | --- |
| 字体菜单 | OpenFontSettingsMenu | 绑定打开字体菜单的按键，默认`LeftAlt + F`。 | |
| 禁用字体阴影 | DisableTextShadow | 是否禁用字体阴影，默认`false`。 | |
| 文本颜色 | TextColor | 设置文本颜色，默认`R=34, G=17, B=34`。 | 兼容[GMCM Options](https://www.nexusmods.com/stardewvalley/mods/10505) |
| 文本颜色（对话） | TextColorDialogue | 设置对话字体文本颜色，默认`R=86, G=22, B=12`。 | 见上 |
| 阴影颜色1 | ShadowColorGame1 | 设置阴影颜色1，默认`R=206, G=156, B=95`。 | 见上 |
| 阴影颜色2 | ShadowColorUtility | 设置阴影颜色2，默认`R=221, G=148, B=84`。 | 见上 |
| 略 | EnableLatinDialogueFont | **（仅针对拉丁文语言，中文无视就好）** 是否允许设置对话字体，默认`true`。 | |
| 编辑模式 | EditMode | 勾选进入编辑（Edit）模式，否则加载（Load）模式。编辑模式能提高兼容性，尤其在多个模组同时修改字体的时候。默认`true`。 | |
| 编辑优先级 | EditPriority | 值越大，越晚编辑。晚的将覆盖早的编辑结果。<br>取值范围：[-2147483648, 2147483647]<br>默认`0`。 | |
| 示例文本 | ExampleText | 设置自定义的文本。将覆盖内置文本，所以一般留空即可。 | |
| UI最小字体大小 | MinFontSize | UI控件允许设置的最小字体大小。默认`1`。 | |
| UI最大字体大小 | MaxFontSize | UI控件允许设置的最大字体大小。默认`100`。 | |
| UI最小字间距 | MinSpacing | UI控件允许设置的最小字间距。默认`-10`。 | |
| UI最大字间距 | MaxSpacing | UI控件允许设置的最大字间距。默认`10`。 | |
| UI最小行间距 | MinLineSpacing | UI控件允许设置的最小行间距。默认`1`。 | |
| UI最大行间距 | MaxLineSpacing | UI控件允许设置的最大行间距。默认`100`。 | |
| UI最小X轴偏移量 | MinCharOffsetX | UI控件允许设置的最小X轴偏移量。默认`-50`。 | |
| UI最大X轴偏移量 | MaxCharOffsetX | UI控件允许设置的最大X轴偏移量。默认`50`。 | |
| UI最小Y轴偏移量 | MinCharOffsetY | UI控件允许设置的最小Y轴偏移量。默认`-50`。 | |
| UI最大Y轴偏移量 | MaxCharOffsetY | UI控件允许设置的最大Y轴偏移量。默认`50`。 | |
| UI最小缩放比例 | MinPixelZoom | UI控件允许设置的最小缩放比例。默认`0.5`。 | |
| UI最大缩放比例 | MaxPixelZoom | UI控件允许设置的最大缩放比例。默认`5`。 | |

## 兼容性
兼容Windows、MacOS、Linux系统。Android版本还在制作中~

#### 和 SpriteMaster 的冲突
触发条件：SpriteMaster版本 > 0.14.0, 本模组版本不限。<br/>
冲突表现：调整参数示例文本不刷新、点击ok键无限加载、cpu爆高。<br/>
解决方法：在配置菜单中，找到 SpriteMaster > Advanced Settings > Extras.OpenGL，取消勾选 `Enabled` 和 `OptimizeTexture2DSetData` 两项，重进游戏。<small>测试环境：FontSettings 0.9.0, SpriteMaster 0.15.0-beta.16.0</small>

#### 回退至1.6.4版本之前的中文字体
1. 下载可选文件*vanilla font file for Chinese (before 1.6.4)*，并按要求安装。
2. 启动游戏，打开字体设置菜单，依次设置游戏内的三种字体类型，每次设置完需要点OK保存。下为各参数：

|     | 小字体 | 中字体 | 对话字体 |
| --- | ---  | ---  | --- |
| 字体 | NotoSansCJKsc-Bold | NotoSansCJKsc-Bold | NotoSansCJKsc-Bold |
| 大小 | 28 | 37 | 34 |
| 字间距 | -1 | 0 | 0 |
| 行间距 | 26 | 38 | 33 |
| 缩放比例 | - | - | 1.5 |

## 给其他模组作者看的
### 编辑模组素材
本模组的图片在`FontSettings/assets`文件夹内，可编辑
* 自用：手动覆盖原先的文件。注意，你的图片必须与原来的**一样大小、文件名**。
* 共享/做成模组：用[Content Patcher](https://www.nexusmods.com/stardewvalley/mods/1915)做成一个cp包。每张png图片都是一个素材，素材名格式为`Mods/Becks723.FontSettings/<文件名>`。

	比如你要编辑`delete.png`，这样写：
	```js
	{
		"Action": "EditImage",
		"Target": "Mods/Becks723.FontSettings/delete",
		"FromFile": "path/to/yourtexturefile.png"
	}
	```
### 制作字体包
见[字体包制作教程](./docs/字体包制作教程.md)。

## 疑难解答
### SMAPI黄字 "Multiple mods want to provide the 'xxx' asset..."
和其他同样修改字体的模组冲突了。解决方案：
- 如果要用本模组，有以下选项：
  - 直接删除冲突的模组。
  - 修改字体的一般都是UI界面美化，用的Content Patcher。因此如果你会写CP代码，可以自己编辑JSON文件解决。
  - 本模组提供了两个配置项：`编辑模式`和`编辑优先级`（见[配置](#配置)）。启用编辑模式即可。

- 如果要用其他模组，有以下选项：
  - 在菜单里取消勾选“启用字体”。

## 反馈 & 帮助
#### 反馈/提问
1. [N网模组页面POSTS栏](https://www.nexusmods.com/stardewvalley/mods/12467?tab=posts)

#### 提交Bug
1. [N网模组页面BUGS栏](https://www.nexusmods.com/stardewvalley/mods/12467?tab=bugs)
2. [Github issues](https://github.com/Becks723/StardewMods/issues)


## 更新日志
#### 0.14.2 - 2024-05-18
- 更新葡语翻译（来自[Si0nk0b](https://www.nexusmods.com/users/142546813)）。
- 修复 启用/禁用平滑字体后对话字体缩放异常 的问题。

#### 0.14.1 - 2024-05-07
- 修复 一些语言下对话字体不生效 的问题。
- 在“缩放比例”的数值尾巴上加了个“x”，以表示倍数。
- 回退原版中文字体配置。

#### 0.14.0 - 2024-04-28
- 兼容游戏1.6.6版本（由于多了平滑字体选项，中文还没完美兼容，最近手头时间紧，请见谅~）
- UI滑动条两边添加箭头，用于微调。
- 修复 某些语言设置对话字体需要点两次确认才生效 的问题。
- 兼容最新的Toolbar Icon接口。

#### 0.13.0 - 2024-04-20
- 兼容游戏1.6.4版本。
  - 同步原版中文字体至最新版本。怀旧党可以自行下载可选字体文件。

#### 0.12.5 - 2024-04-19
- 兼容游戏1.6版本。

#### 0.12.4 - 2023-10-11
- 修复 无法新建预设 的问题。

#### 0.12.3 - 2023-10-10
- 添加葡语翻译（来自[Si0nk0b](https://www.nexusmods.com/users/142546813)）。
- 优化配置相关+GMCM：
  - 修改颜色设置规则，AABBGGRR (十六进制) -> R G B A (十进制)。
  - 修改一些配置项的默认值、描述和取值范围。
    <details>
	  <summary>展开</summary>

      - 编辑模式 默认 关 -> 开。
      - UI最小字体大小 默认 `5` -> `1`。
      - UI最大字体大小 默认 `75` -> `100`。
      - UI最小行间距  默认 `5` -> `1`。
      - UI最大行间距  默认 `75` -> `100`。
      - UI最小X轴偏移量 默认 `-10` -> `-50`。
      - UI最大X轴偏移量 默认 `10` -> `50`。
      - UI最小Y轴偏移量 默认 `-10` -> `-50`。
      - UI最大Y轴偏移量 默认 `10` -> `50`。
      
	</details>

#### 0.12.2 - 2023-08-24
- 修复 部分/全部字符缺失 的问题，在最坏的情况下会直接崩游戏。

#### 0.12.1 - 2023-08-04
- 修复 文字变成透明不可见 的问题。此问题**仅发生于0.12.0首次使用的用户**，修复步骤：
  1. 更新至0.12.1。
  2. 在SMAPI控制台运行 `local data --clear` 命令。

#### 0.12.0 - 2023-07-31
- 新增：
  - 导出功能，导出文体为xnb或可读文件。
  - 颜色设置，文本颜色和阴影颜色两项。见[配置](#配置)。

- 优化：
  - 字体包引入版本控制（`Format`）。
  - 添加`编辑模式`和`编辑优先级`两项配置，提升兼容性。
  - 补充更多“禁用阴影”没有覆盖到的地方。
  - 文档添加[疑难解答](#疑难解答)板块。

- Bug修复：
  - 修复 行间距没有实际应用到对话字体 的问题。
  - 修复 窗口大小调整后菜单不居中 的问题。

#### 0.11.4 - 2023-07-16
- 修复字体包的bug。

#### 0.11.3 - 2023-07-15
- 修复 UI下拉框随机返回顶部 的问题。
- 修复预设界面的若干bug。
- 修复 字体包自带的字体文件漏扫描 的问题。

#### 0.11.2 - 2023-07-11
- 修复 对话字体在未启用时异常变小 的问题。
- 修复 对话字体中一些特殊字符（比如图标）缩得太小 的问题。

#### 0.11.1 - 2023-06-27
- 热修复：对于第一次使用的玩家，修复字体菜单打不开的问题。**恶性bug，务必更新**！

#### 0.11.0 - 2023-06-26
- 支持玩家制作[字体包](#制作字体包)。

#### 0.10.3 - 2023-06-19
- 添加俄文翻译（来自[h4man](https://www.nexusmods.com/stardewvalley/users/100380428)）。
- 移除所有历史版本号上的`【测试版】`标签（主要是没啥意义，又容易误导orz）。

#### 0.10.2 - 2023-06-05
- 修复 删除预设时菜单崩溃 的问题。
- 优化下拉框性能，删除[0.8](#080---2023-04-02)版本临时添加的“减少下拉框卡顿”选项。
- 优化一些俄语的字形轮廓。

#### 0.10.1 - 2023-05-16
- 补全拉丁文字符。

#### 0.10.0 - 2023-05-15
- 此次更新主要面向一些使用拉丁文的语言，允许其设置对话字体。中文不变。
- 优化了示例文本的排版、换行。
- 添加更多日志输出，方便排查。
- 修杂七杂八的bug。

#### 0.9.1 - 2023-04-29
- 修复“保存为新预设”按钮点击没反应的问题。
- 修复预设删不掉的问题。

#### 0.9.0 - 2023-04-18
- 支持 [工具栏图标模组](www.nexusmods.com/stardewvalley/mods/11026)，图标是一个大写的A。
- 支持自定义本模组的图片。
- UI中添加一个“恢复原版字体”选项。
- 稍微调整了下UI菜单外观。

#### 0.8.1 - 2023-04-02
- 修复刷新字体列表后无法选择字体的问题。
- 修复替换字体需要两次才生效的问题。

#### 0.8.0 - 2023-04-02
- 一些性能上的优化：
    - 打开菜单变快
    - 减少卡界面的情况
    - 添加一个选项用于优化下拉框。配置菜单中叫“减少下拉框卡顿”，config.json中叫"SimplifiedDropDown"。详见“配置”段。
- 正式移除嵌入主菜单中的设置界面。
- Bug修复。

#### 0.7.3 - 2023-03-01
- 优化对话字体：修复字符显示不全，切割感。
- 修复点不了ok键的问题。

#### 0.7.2 - 2023-02-20
- 在游戏主菜单左下角添加一个字体按钮，用于打开设置菜单。
- 兼容自定义语言，如泰语、波兰语等。
- Bug修复。

#### 0.7.1 - 2023-02-14
- 模组文件瘦身，将assets/fonts移出主文件，按语言分成多个可选文件。
- 优化“保持原版”时的字体效果。
- Bug修复。

#### 0.7.0 - 2023-02-06
- 优化：
    - 显示UI控件（比如滑动条）的值。
    - 优化“保持原版”时的字体效果。

- Bug修复：
    - 修复“退出存档返回标题后，字体丢失”的问题。
    - 修复“每次打开游戏时，1.ExampleText被清除；2.PixelZoom被重置为1.0”的问题。
    - 补回刷新按钮。

- 兼容性：
    - 移除0.2版本迁移。

#### 0.6.2 - 2022-1-5
- 修复对话字体在未勾选启用时设置失败的问题。

#### 0.6.1 - 2022-1-3
- 热修复：英文替换字体无效果。

#### 0.6 - 2022-1-2
- 全新的UI界面。
- 对话字体允许配置放大倍率。
- 拟移除内置菜单中的字体选项卡。
- 重写核心逻辑。
- 整理内部代码。

#### 0.5.1 - 2022-09-08
- 修复部分情况下字体菜单未与魔法少女界面兼容的问题。

#### 0.5.0 - 2022-09-07
- 新增功能：
    - 允许禁用字体阴影（见上 修改配置 -> DisableTextShadow）。
    - 预设系统（将一个字体设置打包保存，以便下次使用）。
    - 刷新字体列表（选择字体左手边的刷新键），即重新扫描你电脑中的所有字体。
    - 现在可以打开一个独立的字体菜单；游戏内置菜单中的字体栏也可以设置为关闭。

- 取消了配置菜单Generic Mod Config Menu中设置字体的功能，取而代之的是你可以在任何地方打开字体菜单（见 修改配置 -> OpenFontSettingsMenu）。
- 修复与魔法少女界面（n网2668）的冲突（字体设置界面黑框）。感谢n网@TenCalcite 提出问题。

- UI界面内部逻辑重构。
- 修复迁移程序会擦除配置的bug。
- 删除冗余代码。

#### 0.4.0 - 2022-07-25
- 添加一个“字符偏移量”的设置，允许微调字体整体的偏移，以更精确地校准。
- 允许配置字体大小、字间距、行间距、偏移量的极值。
- 用户界面添加记忆功能。（之前每次切全屏/窗口都会重置UI控件的值，现在UI控件的值在同一次游戏中都会保存下来）
- 修复可能存在的缺字漏字情况。（如“测试用例”显示成“测例”）

#### 0.3.2 - 2022-07-18
- 修复字体改变后示例不刷新的问题。
- 重构部分代码，增强程序稳定性。

#### 0.3.1 - 2022-07-17
- 修复选择字体的下拉框的滑动条不显示的问题。

#### 0.3.0 - 2022-07-17
- 全新的设置界面外观。开了新页，不跟自带的选项页挤在一起啦，而且不容易出bug。
- 三个新选项：
  - 合并示例：将原版和当前示例并到一起。
  - 显示边框：显示示例每个字的边框大小。
  - 显示文字：显示示例文字。
<br/>这三个并不影响设置的字体，只是让你看得更清楚点。

#### 0.2.3 - 2022-07-13
- 修复无法正常设置键位的bug。感谢 n网@nineteenLing 提出问题。

#### 0.2.2 - 2022-07-11
- 兼容模组配置菜单GMCM。
- 瘦身模组文件。
- 微调UI界面。（字体选择小标题统一字体）

  已知错误：
- 配置菜单保存设置后，部分文字可能变糊。解决方法：退出菜单重进。

#### 0.2.1 - 2022-06-24
- 移除了fontbm的依赖文件。（n网那个人工智障老是拦文件）

#### 0.2.0 - 2022-06-24
- 将字体设置数据保存至本地（与游戏存档一个位置），这样以后更新模组就不容易丢失之前的字体设置。
- 兼容游戏内置语言。
- 优化下拉框滑动条的手感。
- 修复空格符长度为0的bug。（CJB物品生成器打开菜单卡死的原因就是这个）感谢 n网@yicangyan、@UNCLEDONGLE 提出问题。
- 对话字体已支持设置字间距。

#### 0.1.0 - 2022-06-09
- 初版本，兼容Smapi 3.14.0，Windows、MacOS、Linux系统，语言兼容中文，字体格式兼容TrueType（.ttf, .ttc）、OpenType（.otf, .otc, .ttf, .ttc）。